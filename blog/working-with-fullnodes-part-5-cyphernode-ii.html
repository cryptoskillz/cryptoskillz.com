<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Cyphernode II rebuilding it for ECS - cryptoskillz</title><meta name="description" content="ECS (e-commerce software) is an open source Bitcoin e-commerce server. It comes with a Javascript e-commerce injector a REST server and an admin control panel. "><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://cryptoskillz.com/blog/working-with-fullnodes-part-5-cyphernode-ii.html"><link rel="amphtml" href="https://cryptoskillz.com/blog/amp/working-with-fullnodes-part-5-cyphernode-ii.html"><link rel="alternate" type="application/atom+xml" href="https://cryptoskillz.com/blog/feed.xml"><link rel="alternate" type="application/json" href="https://cryptoskillz.com/blog/feed.json"><meta property="og:title" content="Cyphernode II rebuilding it for ECS"><meta property="og:image" content="https://cryptoskillz.com/blog/media/posts/21/1_h6R4v-LSbRG83IGCUZDN0Q.jpeg"><meta property="og:site_name" content="cryptoskillz"><meta property="og:description" content="ECS (e-commerce software) is an open source Bitcoin e-commerce server. It comes with a Javascript e-commerce injector a REST server and an admin control panel. "><meta property="og:url" content="https://cryptoskillz.com/blog/working-with-fullnodes-part-5-cyphernode-ii.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto:400,500&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cryptoskillz.com/blog/assets/css/style.css?v=1083d802e3f46e75f95035fd641fe7af"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://cryptoskillz.com/blog/working-with-fullnodes-part-5-cyphernode-ii.html"},"headline":"Cyphernode II rebuilding it for ECS","datePublished":"2019-08-19T12:32","dateModified":"2019-11-20T23:19","image":{"@type":"ImageObject","url":"https://cryptoskillz.com/blog/media/posts/21/1_h6R4v-LSbRG83IGCUZDN0Q.jpeg","height":3456,"width":3456},"description":"IntroductionThis guide aims to program a website to accept Bitcoin. In the previous tutorial, we set up and configured \"cyphernode\" which is an excellent dockerised bitcoin and lightning full node plus other useful. Now we are going to set it up to use specifically for our&hellip;","author":{"@type":"Person","name":"cryptoskillz"},"publisher":{"@type":"Organization","name":"cryptoskillz"}}</script><script async src="https://cryptoskillz.com/blog/assets/js/lazysizes.min.js?v=300b16f1c14e1537e6b064f464ab33b1"></script></head><body><header class="topbar js-top is-sticky"><div class="topbar__inner"><a class="logo" href="https://cryptoskillz.com/blog/">cryptoskillz</a><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"><li><a href="https://cryptoskillz.com/index.html" target="_self">ECS</a></li><li><a href="https://cryptoskillz.com/blox.html" target="_self">BLOX</a></li><li><a href="https://cryptoskillz.com/about.html" target="_self">ABOUT</a></li></ul></nav></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2019-12-17T18:35">December 17, 2019</time></div><div class="infobar__search"><form action="https://cryptoskillz.com/blog/search.html"><input type="search" name="q" placeholder=" search..."></form></div></div><main class="main"><div class="banner banner--before-post"><h2 id="mcetoc_1dmt0knbc0">GIVE US YOUR BITCOIN ADVERTISEMENT START</h2><p>Only joking, but not. We want your Bitcoin, any amount will do.  We like Bitcoin and want more of it, so please give it to us.  Click the button below to donate.</p><p><a href="#0" id="sr-add-to-cart" cart-type="2" class="sr-add-to-cart add-to-cart btn btn-primary" data-price="0.01" data-name="Entity T" data-preview="" style="color: #000;">Donate</a> </p><h2 id="mcetoc_1dmt0knbc0">GIVE US YOUR BITCOIN ADVERTISEMENT END</h2></div><article class="post"><figure class="post__featured-image" style="padding-bottom: calc(3456/3456 * 100%)"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_h6R4v-LSbRG83IGCUZDN0Q-xs.jpeg" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_h6R4v-LSbRG83IGCUZDN0Q-xs.jpeg 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_h6R4v-LSbRG83IGCUZDN0Q-sm.jpeg 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_h6R4v-LSbRG83IGCUZDN0Q-md.jpeg 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_h6R4v-LSbRG83IGCUZDN0Q-lg.jpeg 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_h6R4v-LSbRG83IGCUZDN0Q-xl.jpeg 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_h6R4v-LSbRG83IGCUZDN0Q-2xl.jpeg 1600w" data-sizes="auto" alt=""><figcaption>Photo by True Agency on Unsplash</figcaption></figure><header class="u-header post__header"><h1>Cyphernode II rebuilding it for ECS</h1><div class="u-header__meta u-small"><div><a href="https://cryptoskillz.com/blog/authors/cryptoskillz/" title="cryptoskillz">cryptoskillz</a> <time datetime="2019-08-19T12:32">August 19, 2019 </time><a href="https://cryptoskillz.com/blog/ecs/" class="u-tag u-tag--1">ecs</a></div></div></header><div class="post__entry u-inner"><h2 id="e317" class="lf lg bf av au el lh li lj lk ll lm ln lo lp lq lr">Introduction</h2><p id="f921" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">This guide aims to program a website to accept Bitcoin. In the previous tutorial, we set up and configured "<a href="https://cyphernode.io/" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">cyphernode</strong></a><strong class="lu mg">" </strong>which is an excellent dockerised bitcoin and lightning full node plus other useful. Now we are going to set it up to use specifically for our requirements. Namely as a commerce backend for websites.</p><h2 id="ac4d" class="lf lg bf av au el lh li lj lk ll lm ln lo lp lq lr">Configuring cyphernode</h2><p id="b852" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">We are going to make a number of changes to the tutorial in the previous "<a class="cb bx lb lc ld le" target="_blank" href="https://medium.com/bitcoin-e-commerce-development/part-18-cyphernode-ab682ff85659" rel="noopener noreferrer"><strong class="lu mg">article</strong></a>" which was simply showing how to get "<a href="https://cyphernode.io/" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">cyphernode</strong></a>" working in its default set up.</p><h3 id="51b2" class="mh lg bf av au el mi mj mk ml mm mn mo mp mq mr ms">Remove Lightning</h3><p id="fa43" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">As we do not natively support it yet</p><h3 id="06f6" class="mh lg bf av au el mi mj mk ml mm mn mo mp mq mr ms">Prune the blockchain</h3><p id="af6f" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">As we are using it to do as a commerce server and every sale will we do is moved to our cold storage via a hardware wallet (such as "<a href="https://www.ledgerwallet.com/products/12-ledger-nano-s" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg"><a href="https://cryptoskillz.com/blog/working-with-fullnodes-part-5-cyphernode-ii.html">Ledger</a></strong></a>") or a full node (such as "<a href="https://store.casa/lightning-node/" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">casa</strong></a>") which has been built to be a store of value.</p><h2 id="9991" class="mh lg bf av au el mi mj mk ml mm mn mo mp mq mr ms">Building cyphernode</h2><p id="cf78" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">Note, a number of these steps are a repetition of the previous "<strong class="lu mg">article</strong>" but it is worth repeating as they change (although subtly) in a significant manner.</p><p id="7799" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Open a terminal client (we use Macs) if you use Windows use "<a href="https://www.putty.org/" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">putty</strong></a><strong class="lu mg">"</strong> or whatever terminal client you are comfortable with.</p><p id="3af2" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><strong class="lu mg">Step 1: Create a directory</strong></p><pre class="ke kf kg kh ki dv ge df"><span id="e0f8" class="mh lg bf av my b dz mz na l nb" data-selectable-paragraph="">mkdir cyphernode &amp;&amp; cd cyphernode</span></pre><p id="e81f" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><strong class="lu mg">Step 2: Run quick install of cyphernode</strong></p><pre class="ke kf kg kh ki dv ge df"><span id="4a7a" class="mh lg bf av my b dz mz na l nb" data-selectable-paragraph="">curl -fsSL <a href="https://raw.githubusercontent.com/SatoshiPortal/cyphernode/master/dist/setup.sh" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/SatoshiPortal/cyphernode/master/dist/setup.sh</a> -o setup_cyphernode.sh &amp;&amp; chmod +x setup_cyphernode.sh &amp;&amp; ./setup_cyphernode.sh</span></pre><p id="cd78" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><strong class="lu mg">Step 3: run through cyphernode set up</strong></p><p id="e0fc" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">The first thing you will see a progress window (as shown in the screenshot below) that is basically the cyphernode set up downloading everything it requires to complete the installation.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1-2xl.png 1600w" alt="" width="1728" height="281"></figure><p id="a70b" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, you will see is a prompt asking you for a password add one, obviously. Remember this password as it comes in handy (a lot) later.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_32xpgCDTEfRlPZc7kHvYeA-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_32xpgCDTEfRlPZc7kHvYeA-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_32xpgCDTEfRlPZc7kHvYeA-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_32xpgCDTEfRlPZc7kHvYeA-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_32xpgCDTEfRlPZc7kHvYeA-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_32xpgCDTEfRlPZc7kHvYeA-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_32xpgCDTEfRlPZc7kHvYeA-2xl.png 1600w" alt="" width="1405" height="126"></figure><p id="a3fe" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">After that you are presented with is the one below, press return as help is always good, right?</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/0_tvAQgJ-qh3uRdMgY-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/0_tvAQgJ-qh3uRdMgY-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/0_tvAQgJ-qh3uRdMgY-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/0_tvAQgJ-qh3uRdMgY-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/0_tvAQgJ-qh3uRdMgY-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/0_tvAQgJ-qh3uRdMgY-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/0_tvAQgJ-qh3uRdMgY-2xl.png 1600w" alt="" width="1400" height="663"></figure><p id="4a5a" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, it will prompt you to install extra software. We do not require either "<a href="https://en.wikipedia.org/wiki/Lightning_Network" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">Lightning</strong></a>" or "<a href="https://github.com/opentimestamps/opentimestamps-client" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">Opentimestamps client</strong></a>" yet so just press return to move onto the next stage.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_wyFEHuAJgg3B8PY51rs1vQ-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_wyFEHuAJgg3B8PY51rs1vQ-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_wyFEHuAJgg3B8PY51rs1vQ-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_wyFEHuAJgg3B8PY51rs1vQ-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_wyFEHuAJgg3B8PY51rs1vQ-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_wyFEHuAJgg3B8PY51rs1vQ-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_wyFEHuAJgg3B8PY51rs1vQ-2xl.png 1600w" alt="" width="1127" height="169"></figure><p id="7827" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, we want to select Testnet as we are testing.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_P4DgFm_MaK9MeWGbXieYXg-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_P4DgFm_MaK9MeWGbXieYXg-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_P4DgFm_MaK9MeWGbXieYXg-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_P4DgFm_MaK9MeWGbXieYXg-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_P4DgFm_MaK9MeWGbXieYXg-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_P4DgFm_MaK9MeWGbXieYXg-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_P4DgFm_MaK9MeWGbXieYXg-2xl.png 1600w" alt="" width="1216" height="154"></figure><p id="0cdd" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, It asks to change user which is very good advice which we are going to ignore for the sake of simplicity. Go ahead and select N. </p><p data-selectable-paragraph="">Note the above it correct for local instances but if you are hosting on digitial ocean (or any provider for that matter) it will most likely be better if you select Y and create a new user (the default is cyphernode and you should go with this) otherwise you will most likely run into permission issues (espically with gatekeeper)</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_FS-e2QKY5ybkqVNaOkfRUg-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_FS-e2QKY5ybkqVNaOkfRUg-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_FS-e2QKY5ybkqVNaOkfRUg-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_FS-e2QKY5ybkqVNaOkfRUg-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_FS-e2QKY5ybkqVNaOkfRUg-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_FS-e2QKY5ybkqVNaOkfRUg-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_FS-e2QKY5ybkqVNaOkfRUg-2xl.png 1600w" alt="" width="1169" height="260"></figure><p id="8fb2" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, select "N". To be frank, we are still not 100% sure what is "<a href="https://support.blockchain.com/hc/en-us/articles/360000939843-Understanding-the-xPub-and-address-generation" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">xPub</strong></a>" is and until we do and can make an informed decision about it we are going to ignore its existence.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_sQSemJH9liax29ac84tvIw-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_sQSemJH9liax29ac84tvIw-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sQSemJH9liax29ac84tvIw-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sQSemJH9liax29ac84tvIw-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sQSemJH9liax29ac84tvIw-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sQSemJH9liax29ac84tvIw-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sQSemJH9liax29ac84tvIw-2xl.png 1600w" alt="" width="1154" height="233"></figure><p id="5dcb" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, We have to give an encryption passphrase that gatekeeper will use for authentication. Go ahead and add one.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_9RdYsmKXAcqjfFidUyGdqQ-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_9RdYsmKXAcqjfFidUyGdqQ-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_9RdYsmKXAcqjfFidUyGdqQ-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_9RdYsmKXAcqjfFidUyGdqQ-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_9RdYsmKXAcqjfFidUyGdqQ-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_9RdYsmKXAcqjfFidUyGdqQ-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_9RdYsmKXAcqjfFidUyGdqQ-2xl.png 1600w" alt="" width="1190" height="316"></figure><p id="dc2b" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, select a port. 2009 is fine so just press return</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_R6iF_aXtV8vH5T_2MNfHQA-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_R6iF_aXtV8vH5T_2MNfHQA-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_R6iF_aXtV8vH5T_2MNfHQA-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_R6iF_aXtV8vH5T_2MNfHQA-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_R6iF_aXtV8vH5T_2MNfHQA-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_R6iF_aXtV8vH5T_2MNfHQA-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_R6iF_aXtV8vH5T_2MNfHQA-2xl.png 1600w" alt="" width="1197" height="32"></figure><p id="9bc8" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, set up the IP’s we are going to run everything over 127.0.0.1 for now so just press return.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_Z88sXbsLw5OeGif5SvF0eQ-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_Z88sXbsLw5OeGif5SvF0eQ-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Z88sXbsLw5OeGif5SvF0eQ-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Z88sXbsLw5OeGif5SvF0eQ-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Z88sXbsLw5OeGif5SvF0eQ-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Z88sXbsLw5OeGif5SvF0eQ-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Z88sXbsLw5OeGif5SvF0eQ-2xl.png 1600w" alt="" width="1245" height="249"></figure><p id="1824" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, Again press return as we are happy to route all traffic through port 80</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_VFi9nsHJY2UahMiNCbe2tQ-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_VFi9nsHJY2UahMiNCbe2tQ-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_VFi9nsHJY2UahMiNCbe2tQ-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_VFi9nsHJY2UahMiNCbe2tQ-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_VFi9nsHJY2UahMiNCbe2tQ-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_VFi9nsHJY2UahMiNCbe2tQ-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_VFi9nsHJY2UahMiNCbe2tQ-2xl.png 1600w" alt="" width="1160" height="40"></figure><p id="af86" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, press return as we want to https to be on the default port.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_zb4UXqnEZrridF6QWyanMA-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_zb4UXqnEZrridF6QWyanMA-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_zb4UXqnEZrridF6QWyanMA-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_zb4UXqnEZrridF6QWyanMA-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_zb4UXqnEZrridF6QWyanMA-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_zb4UXqnEZrridF6QWyanMA-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_zb4UXqnEZrridF6QWyanMA-2xl.png 1600w" alt="" width="1223" height="34"></figure><p id="4e6f" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Now, It is telling us it will look after the full node for us yay. Press return.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_vz1oq2X8C9yUVM8j5gLGRQ-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_vz1oq2X8C9yUVM8j5gLGRQ-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_vz1oq2X8C9yUVM8j5gLGRQ-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_vz1oq2X8C9yUVM8j5gLGRQ-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_vz1oq2X8C9yUVM8j5gLGRQ-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_vz1oq2X8C9yUVM8j5gLGRQ-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_vz1oq2X8C9yUVM8j5gLGRQ-2xl.png 1600w" alt="" width="1248" height="304"></figure><p id="7fd6" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, we have to add an RPC username. "admin" is always good</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_BQwX_NXe6P-d_lCZtuJHEA-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_BQwX_NXe6P-d_lCZtuJHEA-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_BQwX_NXe6P-d_lCZtuJHEA-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_BQwX_NXe6P-d_lCZtuJHEA-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_BQwX_NXe6P-d_lCZtuJHEA-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_BQwX_NXe6P-d_lCZtuJHEA-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_BQwX_NXe6P-d_lCZtuJHEA-2xl.png 1600w" alt="" width="1149" height="145"></figure><p id="8bfb" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, we have to add an RPC password.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/pass-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/pass-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/pass-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/pass-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/pass-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/pass-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/pass-2xl.png 1600w" alt="" width="1075" height="50"></figure><p id="ed16" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, type "Y’ as we want to run the full node in "<a href="https://coinguides.org/bitcoin-blockchain-pruning/" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">prune</strong></a>" mode</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_nnXroHU5WM0GWbRnG3wutg-1-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_nnXroHU5WM0GWbRnG3wutg-1-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_nnXroHU5WM0GWbRnG3wutg-1-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_nnXroHU5WM0GWbRnG3wutg-1-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_nnXroHU5WM0GWbRnG3wutg-1-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_nnXroHU5WM0GWbRnG3wutg-1-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_nnXroHU5WM0GWbRnG3wutg-1-2xl.png 1600w" alt="" width="1153" height="230"></figure><p id="d936" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, we want to select 550 megabytes this is the default option so just press return.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_HrOFqakZgRc_PVVBfrvaAg-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_HrOFqakZgRc_PVVBfrvaAg-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_HrOFqakZgRc_PVVBfrvaAg-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_HrOFqakZgRc_PVVBfrvaAg-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_HrOFqakZgRc_PVVBfrvaAg-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_HrOFqakZgRc_PVVBfrvaAg-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_HrOFqakZgRc_PVVBfrvaAg-2xl.png 1600w" alt="" width="1348" height="180"></figure><p id="fac3" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, you can add a UA comment here if you want (we did not)</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_ROeDTiEzmltDo1DXqc9_Kg-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_ROeDTiEzmltDo1DXqc9_Kg-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_ROeDTiEzmltDo1DXqc9_Kg-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_ROeDTiEzmltDo1DXqc9_Kg-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_ROeDTiEzmltDo1DXqc9_Kg-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_ROeDTiEzmltDo1DXqc9_Kg-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_ROeDTiEzmltDo1DXqc9_Kg-2xl.png 1600w" alt="" width="1085" height="147"></figure><p id="77db" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, Press return as we are presented with one option and luckily it is the option we want.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_D2w2SM1-T-WgCVNRlp62KQ-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_D2w2SM1-T-WgCVNRlp62KQ-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_D2w2SM1-T-WgCVNRlp62KQ-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_D2w2SM1-T-WgCVNRlp62KQ-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_D2w2SM1-T-WgCVNRlp62KQ-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_D2w2SM1-T-WgCVNRlp62KQ-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_D2w2SM1-T-WgCVNRlp62KQ-2xl.png 1600w" alt="" width="1291" height="161"></figure><p id="c324" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, you are going to be asked for the location of where to put the files just press return 4 times as the defaults are good and you will be presented with the below</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_CF3iKmOGsHV4qko4LI-k0Q-1-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_CF3iKmOGsHV4qko4LI-k0Q-1-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_CF3iKmOGsHV4qko4LI-k0Q-1-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_CF3iKmOGsHV4qko4LI-k0Q-1-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_CF3iKmOGsHV4qko4LI-k0Q-1-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_CF3iKmOGsHV4qko4LI-k0Q-1-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_CF3iKmOGsHV4qko4LI-k0Q-1-2xl.png 1600w" alt="" width="1284" height="890"></figure><p id="dad8" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, We do want to expose so press "Y" followed by return.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_sJV62NV2s2Eu3sBjlE6uoA-1-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_sJV62NV2s2Eu3sBjlE6uoA-1-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sJV62NV2s2Eu3sBjlE6uoA-1-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sJV62NV2s2Eu3sBjlE6uoA-1-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sJV62NV2s2Eu3sBjlE6uoA-1-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sJV62NV2s2Eu3sBjlE6uoA-1-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_sJV62NV2s2Eu3sBjlE6uoA-1-2xl.png 1600w" alt="" width="1157" height="42"></figure><p id="f5f2" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Again, we are happy for the full node to expose itself so press "Y" and return again</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_OS7NSnWin3KnsVHJGEFOEg-1-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_OS7NSnWin3KnsVHJGEFOEg-1-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_OS7NSnWin3KnsVHJGEFOEg-1-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_OS7NSnWin3KnsVHJGEFOEg-1-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_OS7NSnWin3KnsVHJGEFOEg-1-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_OS7NSnWin3KnsVHJGEFOEg-1-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_OS7NSnWin3KnsVHJGEFOEg-1-2xl.png 1600w" alt="" width="1207" height="202"></figure><p id="1e1c" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, you want to choose from docker-compose or docker swarm. We selected docker-compose and suggest you do the same.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_4XdDfcRT71pNiqwt9YFI6Q-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_4XdDfcRT71pNiqwt9YFI6Q-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_4XdDfcRT71pNiqwt9YFI6Q-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_4XdDfcRT71pNiqwt9YFI6Q-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_4XdDfcRT71pNiqwt9YFI6Q-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_4XdDfcRT71pNiqwt9YFI6Q-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_4XdDfcRT71pNiqwt9YFI6Q-2xl.png 1600w" alt="" width="1174" height="246"></figure><p id="9e0c" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Next, type "Y" as it is always good to clean up after yourself.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/1_Dse884374fQRAddULzgjcg-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/1_Dse884374fQRAddULzgjcg-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Dse884374fQRAddULzgjcg-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Dse884374fQRAddULzgjcg-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Dse884374fQRAddULzgjcg-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Dse884374fQRAddULzgjcg-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/1_Dse884374fQRAddULzgjcg-2xl.png 1600w" alt="" width="1222" height="169"></figure><p id="101c" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Finally, you will see some output (like the screenshot below) that is the installation completed.</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/2-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/2-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/2-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/2-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/2-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/2-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/2-2xl.png 1600w" alt="" width="1189" height="472"></figure><p id="8feb" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Once it is finished you will see the following</p><figure class="post__image"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/21/responsive/3-xs.png" data-sizes="auto" data-srcset="https://cryptoskillz.com/blog/media/posts/21/responsive/3-xs.png 300w ,https://cryptoskillz.com/blog/media/posts/21/responsive/3-sm.png 480w ,https://cryptoskillz.com/blog/media/posts/21/responsive/3-md.png 768w ,https://cryptoskillz.com/blog/media/posts/21/responsive/3-lg.png 1024w ,https://cryptoskillz.com/blog/media/posts/21/responsive/3-xl.png 1360w ,https://cryptoskillz.com/blog/media/posts/21/responsive/3-2xl.png 1600w" alt="" width="1368" height="315"></figure><p data-selectable-paragraph=""> </p><h1 id="0f5f" class="lf lg bf av au el lh li lj lk ll lm ln lo lp lq lr" data-selectable-paragraph="">Useful things to know about cyphernode</h1><p id="a3a9" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">Now we have been playing with cyphernode for a few weeks our understanding is growing and a result it makes sense to list the most common things that slowed us down in our studying of this excellent product.</p><h2 id="8662" class="mh lg bf av au el mi mj mk ml mm mn mo mp mq mr ms" data-selectable-paragraph="">zipped files</h2><p id="518a" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph=""><strong class="lu mg">client.7z<br></strong>Use your password you set at the being to unzip this and you will find the private keys for your wallets.</p><p id="feb3" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><strong class="lu mg">config.7z<br></strong>Again, use your password to unzip this and you will find a config file that you can use to build more versions of cyphernode with this configuration.</p><p id="61ef" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><strong class="lu mg">wallet directory<br></strong>There are 4 wallets referenced in the bitcoin.conf file and it is assumed (at this point) that are using some pattern to set the wallet names. Further experiment will show us what this pattern is.</p><p id="6daa" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><em class="pc">watching01.dat<br></em>not sure what this wallet is for our hunch is it may be for watch only nodes. We will have to research this further.</p><p id="4c20" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><em class="pc">xpubwatching01.dat<br></em>Not sure about this one either but we can infer from its name that it is to do with Xpub which we are also going to be looking into.</p><p id="6c22" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><em class="pc">spending01.dat<br></em>This is the main wallet file that full node uses</p><p id="08a9" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><em class="pc">ln01.dat<br></em>This is the wallet that the lightning node uses.</p><h1 id="5dfa" class="lf lg bf av au el lh li lj lk ll lm ln lo lp lq lr" data-selectable-paragraph="">ECS</h1><p id="6773" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">It has been a while since we have actually slung some code for ECS and Bitcoin development moves at a steady clip so it is nice to get back and update it.</p><p id="123d" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Our main goals for this code update is to make ECS support the latest version of "<a href="https://bitcoin.org/en/bitcoin-core/" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">Bitcoin Core</strong></a>" which at the time of writing this is 0.18.1.</p><p id="4743" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">As we were replacing our cobbled together backend with the infinitely superior "<a href="https://cyphernode.io/" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">cyphernode</strong></a>" we thought it would be prudent to make it agnostic at this point so it would work with any backend</p><p id="3f81" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">The latest branch that deals with code in this tutorial can be found "<a href="https://github.com/cryptoskillz/ECS/tree/part19-cyphernode-integration" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">here</strong></a>"</p><p id="d9e1" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">It is worth noting that we literately changed our entire back end here and because Bitcoin has been so awesomely programmed it took about a day and required about adding 10 lines of code. Working on e-commerce for well over a decade I know how hard this would have been using traditional e-commerce/banking/fintech architecture. We are really entertaining a golden time for payments.</p><h2 id="d025" class="mh lg bf av au el mi mj mk ml mm mn mo mp mq mr ms" data-selectable-paragraph="">Database base changes</h2><p id="dae9" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">None</p><h2 id="34a4" class="mh lg bf av au el mi mj mk ml mm mn mo mp mq mr ms" data-selectable-paragraph="">Code Changes</h2><p id="bba0" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">Apart from the odd bug fix here and there (which you can see by looking at the "<a href="https://github.com/cryptoskillz/ECS/commits/part19-cyphernode-integration" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">commit history</strong></a>" if you really want to) all of the refactorings we did was in the "<a href="https://github.com/cryptoskillz/ECS/tree/part19-cyphernode-integration/server" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">server</strong></a>" component. So let us go ahead and break down the changes we made.</p><p id="28a0" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><strong class="lu mg">"</strong><a href="https://github.com/cryptoskillz/ECS/blob/part19-cyphernode-integration/server/.env_copy" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">.env </strong></a><strong class="lu mg">"changes</strong></p><p id="71c6" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">As the concept of accounts has been "<a href="https://github.com/bitcoin-dot-org/bitcoin.org/issues/1287" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">deprecated</strong></a>" in the latest version bitcoin core we changed the env var to just hold the wallet.</p><p id="6b6b" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Note there were 4 wallets that cyphernode created and with some trial and error we found out the one we want is called ‘spending01.dat’ so we preconfigured it to this in the env vars below.</p><pre class="ke kf kg kh ki dv ge df"><span id="d9b6" class="mh lg bf av my b dz mz na l nb" data-selectable-paragraph="">EMAILSMTP = <br>EMAILUSERNAME = <br>EMAILPASSWORD = <br>WALLETPASSPHRASE = <br>WALLET = 'spending01.dat'<br>RPCUSERNAME = <br>NETWORK = 1<br>LIGHTNETWORK=2<br>RPCUSERNAME =<br>RPCPASSWORD = <br>RPCHOST = 127.0.0.1 <br>RPCPORT = 18332<br>BLOCKIOKEY = <br>BLOCKIOSECRET = <br>PORT = 3030<br>CONFIRMATIONS=1<br>STRIKEAPIKEY=<br>STRIKEENDPOINT=</span></pre><p id="21aa" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">"<a href="https://github.com/cryptoskillz/ECS/blob/part19-cyphernode-integration/server/config.js" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">config.js</strong></a>" changes</p><p id="3d89" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">We upgraded "<a href="https://www.npmjs.com/package/bitcoin-core" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">bitcoin cor</strong></a><strong class="lu mg">e</strong>" to 2.2.0 and it facilitated the name of the wallet we are using in the config parameter so we went ahead and did that. I would like an RPC call that returned the default wallet</p><pre class="ke kf kg kh ki dv ge df"><span id="e71b" class="mh lg bf av my b dz mz na l nb" data-selectable-paragraph="">const Client = require("bitcoin-core");<br>if (process.env.NETWORK == 1) {<br>  client = new Client({<br>    host: "127.0.0.1",<br>    port: 18332,<br>    wallet: process.env.WALLET,<br>    username: process.env.RPCUSERNAME,<br>    password: process.env.RPCPASSWORD<br>  });<br>}</span><span id="2a36" class="mh lg bf av my b dz pd pe pf pg ph na l nb" data-selectable-paragraph="">if (process.env.NETWORK == 2) {<br>  client = new Client({<br>    host: "127.0.0.1",<br>    port: 8332,<br>    wallet: process.env.WALLET,<br>    username: process.env.RPCUSERNAME,<br>    password: process.env.RPCPASSWORD<br>  });<br>}</span></pre><p id="f4b4" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph=""><strong class="lu mg">"</strong><a href="https://github.com/cryptoskillz/ECS/tree/part19-cyphernode-integration/server/api/helpers" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">api.js </strong></a><strong class="lu mg">"changes</strong></p><p id="e556" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">We removed the account and passphrase code. We may add the passphrase option back in the future but it will have to be switchable so it works with backends that have encrypted wallets (or not)</p><pre class="ke kf kg kh ki dv ge df"><span id="2f51" class="mh lg bf av my b dz mz na l nb" data-selectable-paragraph="">this.generateAddress = function generateAddress(uid, res) {<br>  //create a new address in theaccount account :]<br>  client.getNewAddress().then(address =&gt; {<br>    //debug<br>    //console.log(address);</span><span id="2f23" class="mh lg bf av my b dz pd pe pf pg ph na l nb" data-selectable-paragraph="">//insert it into the database<br>    db.run(<br>      `INSERT INTO sessions(address,userid,net) VALUES(?,?,?)`,<br>      [address, uid, process.env.NETWORK],<br>      function(err) {<br>        if (err) {<br>          //debug<br>          //return console.log(err.message);</span><span id="c126" class="mh lg bf av my b dz pd pe pf pg ph na l nb" data-selectable-paragraph="">//return error<br>          res.send(JSON.stringify({ error: err.message }));<br>          return;<br>        }<br>        //return the address<br>        res.send(JSON.stringify({ address: address }));<br>      }<br>    );<br>    return;<br>  });<br>};</span></pre><p id="2ed8" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">We also recorded the sweep function to use the much simpler "<a href="https://bitcoincore.org/en/doc/0.16.0/rpc/wallet/sendtoaddress/" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">sendtoaddress</strong></a><strong class="lu mg">"</strong> function that was introduced in 0.16.0.</p><pre class="ke kf kg kh ki dv ge df"><span id="138c" class="mh lg bf av my b dz mz na l nb" data-selectable-paragraph="">this.sweep = function sweep(address, res) {<br>  let sqldata = [0];<br>  let sql = `select * from ecs_coldstorageaddresses where used = ?`;</span><span id="5062" class="mh lg bf av my b dz pd pe pf pg ph na l nb" data-selectable-paragraph="">//get a cold storage address<br>  db.get(sql, sqldata, (err, result) =&gt; {<br>    if (err) {<br>      return console.error(err.message);<br>    }<br>    //save the address<br>    var coldstorageaddress = result.address;<br>    client.listUnspent(1, 9999999, [address]).then(result =&gt; {<br>      //debug<br>      console.log(result[0]);<br>      if (result.length == 0) {<br>        //debug<br>        //console.log(result);<br>        res.send(<br>          JSON.stringify({<br>            result: "nothing to sweep no unspent transactions"<br>          })<br>        );<br>        return;<br>      } else {<br>        if (result[0].confirmations &gt;= process.env.CONFIRMATIONS) {<br>          amounttosend = result[0].amount.toFixed(8);<br>          //debug<br>          console.log("ams" + amounttosend);<br>          //return;<br>          client<br>            .sendToAddress(coldstorageaddress, amounttosend)<br>            .then(result =&gt; {<br>let sqldata = ["1", address];<br>              let sql = `UPDATE sessions<br>                  SET swept = ?<br>                  WHERE address = ?`;<br>              //run sql<br>              db.run(sql, sqldata, function(err) {<br>                if (err) {<br>                }<br>                //update the address in cold storage so it is not used again.<br>                //build sql<br>                let sqldata = ["1", coldstorageaddress];<br>                let sql = `UPDATE ecs_coldstorageaddresses<br>                               SET used = ?<br>                              WHERE ecs_coldstorageaddress = ?`;<br>                //run sql<br>                db.run(sql, sqldata, function(err) {<br>                  if (err) {<br>                  }<br>                  //return status<br>                  res.send(JSON.stringify({ status: "swept" }));<br>                  return;<br>                });<br>              });<br>            });<br>        } else {<br>          //return status<br>          res.send(<br>            JSON.stringify({<br>              status: "not enough confirmations :" + result[0].confirmations<br>            })<br>          );<br>          return;<br>        }<br>      }<br>    });<br>  });<br>};</span></pre><p id="aa9b" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">"<a href="https://github.com/cryptoskillz/ECS/blob/part19-cyphernode-integration/server/api/helpers/webhook.js" class="cb bx lb lc ld le" target="_blank" rel="noopener noreferrer"><strong class="lu mg">webhook.js</strong></a>" <strong class="lu mg">changes</strong></p><p id="742d" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">Again we removed the account and passphrase code.</p><pre class="ke kf kg kh ki dv ge df"><span id="2d93" class="mh lg bf av my b dz mz na l nb" data-selectable-paragraph="">this.checkPayment = function checkPayment(token, address, res) {<br>  //get the unspent transactions for the address we are intrested in.<br>  client.listUnspent(1, 9999999, [address]).then(result =&gt; {</span><span id="55db" class="mh lg bf av my b dz pd pe pf pg ph na l nb" data-selectable-paragraph="">    if (result.length &gt; 0) {<br>      //check the confirmations (set int the env var)<br><br>      //in any live enviorment.<br>      if (result[0].confirmations &gt;= process.env.CONFIRMATIONS) {<br>        //valid<br>        res.send(JSON.stringify({ status: 1 }));<br>      } else {<br>        //not valid<br>        res.send(JSON.stringify({ status: 0 }));<br>      }<br>    } else {<br>      res.send(JSON.stringify({ status: 0 }));<br>    }<br>  });<br>};</span></pre><h1 id="3414" class="lf lg bf av au el lh li lj lk ll lm ln lo lp lq lr" data-selectable-paragraph="">Conclusion</h1><p id="b0aa" class="ls lt bf av lu b lv lw lx ly lz ma mb mc md me mf" data-selectable-paragraph="">That is it, it was a very easy upgrade especially seeing as we completely replaced the backend. This is the beauty of Bitcoin it gives you control of every aspect of the flow. Imagine replacing your PCI server for you ecommerce provider over a weekend requiring the permission of no one :]</p><p id="541c" class="ls lt bf av lu b lv mt lx mu lz mv mb mw md mx mf" data-selectable-paragraph="">In the next article, we will host this and replace our test store with the new code.</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on November 20, 2019</div><div class="post__share"></div></aside><footer class="post__footer"><div class="post__bio u-author box"><div><h4 class="u-author__name"><a href="https://cryptoskillz.com/blog/authors/cryptoskillz/" title="cryptoskillz">cryptoskillz</a></h4></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://cryptoskillz.com/blog/working-with-full-nodes-part-4-cyphernode-i.html" class="post__nav__link" rel="prev"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/20/responsive/1_8uCeMDcHVyVSlXe0y6UCtg-xs.png" data-srcset="https://cryptoskillz.com/blog/media/posts/20/responsive/1_8uCeMDcHVyVSlXe0y6UCtg-xs.png" data-expand="300" alt=""><div class="u-small">Previous Post<h5>Introduction to Cyphernode</h5></div></a></div><div class="post__nav__next"><a href="https://cryptoskillz.com/blog/working-with-fullnodes-part-6-cyphernode-iii.html" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>Cyphernode III setting up Lightning</h5></div><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/22/responsive/0_tnWANgeBqBWRZOxF-xs.png" data-srcset="https://cryptoskillz.com/blog/media/posts/22/responsive/0_tnWANgeBqBWRZOxF-xs.png" data-expand="300" alt=""></a></div></nav></footer></article><div class="banner banner--after-post"><script type="text/javascript" src="https://cryptoskillz.com/srcrypto/prod/cdn/js/sr.js"></script><script type="text/javascript">SR.init(["https://ecslive.cryptoskillz.com/",15,"https://cryptoskillz.com/srcrypto/prod/cdn/theme/","39",0,"GB",0,""]);</script></div></main><div class="sidebar"><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://cryptoskillz.com/blog/cyphernode/">cyphernode</a> <span class="u-small">(6)</span></li><li><a href="https://cryptoskillz.com/blog/ecs/">ecs</a> <span class="u-small">(27)</span></li><li><a href="https://cryptoskillz.com/blog/fullnode/">fullnode</a> <span class="u-small">(10)</span></li><li><a href="https://cryptoskillz.com/blog/trx/">trx</a> <span class="u-small">(2)</span></li><li><a href="https://cryptoskillz.com/blog/wink/">wink</a> <span class="u-small">(2)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://cryptoskillz.com/blog/">cryptoskillz</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright">Powered by Publii</div></footer></div><script defer="defer" src="https://cryptoskillz.com/blog/assets/js/jquery-3.2.1.slim.min.js?v=5f48fc77cac90c4778fa24ec9c57f37d"></script><script defer="defer" src="https://cryptoskillz.com/blog/assets/js/scripts.min.js?v=07b53ae91f8045eab042a695e4a26034"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-111636971-1"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111636971-1');</script></body></html>