<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>WWW and modularisation - cryptoskillz</title><meta name="description" content="ECS (e-commerce software) is an open source Bitcoin e-commerce server. It comes with a Javascript e-commerce injector a REST server and an admin control panel. "><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://cryptoskillz.com/blog/www-and-modularisation.html"><link rel="amphtml" href="https://cryptoskillz.com/blog/amp/www-and-modularisation.html"><link rel="alternate" type="application/atom+xml" href="https://cryptoskillz.com/blog/feed.xml"><link rel="alternate" type="application/json" href="https://cryptoskillz.com/blog/feed.json"><meta property="og:title" content="WWW and modularisation"><meta property="og:image" content="https://cryptoskillz.com/blog/media/posts/7/1_KOjqZHotBNn9-PIMA9XTHQ.jpeg"><meta property="og:site_name" content="cryptoskillz"><meta property="og:description" content="ECS (e-commerce software) is an open source Bitcoin e-commerce server. It comes with a Javascript e-commerce injector a REST server and an admin control panel. "><meta property="og:url" content="https://cryptoskillz.com/blog/www-and-modularisation.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto:400,500&amp;subset=latin-ext&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cryptoskillz.com/blog/assets/css/style.css?v=1083d802e3f46e75f95035fd641fe7af"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://cryptoskillz.com/blog/www-and-modularisation.html"},"headline":"WWW and modularisation","datePublished":"2018-09-29T11:36","dateModified":"2019-10-10T23:41","image":{"@type":"ImageObject","url":"https://cryptoskillz.com/blog/media/posts/7/1_KOjqZHotBNn9-PIMA9XTHQ.jpeg","height":478,"width":638},"description":" This guide aims to program a website to accept Bitcoin. In the previous part, we coded \"sweep.js\" which allowed us to move payments to our cold storage. In this section, we are going to modularise the code (a little) and create a \"WWW\" page to&hellip;","author":{"@type":"Person","name":"cryptoskillz"},"publisher":{"@type":"Organization","name":"cryptoskillz"}}</script><script async src="https://cryptoskillz.com/blog/assets/js/lazysizes.min.js?v=300b16f1c14e1537e6b064f464ab33b1"></script></head><body><header class="topbar js-top is-sticky"><div class="topbar__inner"><a class="logo" href="https://cryptoskillz.com/blog/">cryptoskillz</a><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"><li><a href="https://cryptoskillz.com/index.html" target="_self">ECS</a></li><li><a href="https://cryptoskillz.com/blox.html" target="_self">BLOX</a></li><li><a href="https://cryptoskillz.com/about.html" target="_self">ABOUT</a></li></ul></nav></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2019-11-05T17:19">November 5, 2019</time></div><div class="infobar__search"><form action="https://cryptoskillz.com/blog/search.html"><input type="search" name="q" placeholder=" search..."></form></div></div><main class="main"><div class="banner banner--before-post"><h2 id="mcetoc_1dmt0knbc0">GIVE US YOUR BITCOIN ADVERTISEMENT START</h2><p>Only joking, but not. We want your Bitcoin, any amount will do.  We like Bitcoin and want more of it, so please give it to us.  Click the button below to donate.</p><p><a href="#0" id="sr-add-to-cart" cart-type="2" class="sr-add-to-cart add-to-cart btn btn-primary" data-price="0.01" data-name="Entity T" data-preview="" style="color: #000;">Donate</a> </p><h2 id="mcetoc_1dmt0knbc0">GIVE US YOUR BITCOIN ADVERTISEMENT END</h2></div><article class="post"><figure class="post__featured-image" style="padding-bottom: calc(478/638 * 100%)"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/7/responsive/1_KOjqZHotBNn9-PIMA9XTHQ-xs.jpeg" data-srcset="https://cryptoskillz.com/blog/media/posts/7/responsive/1_KOjqZHotBNn9-PIMA9XTHQ-xs.jpeg 300w ,https://cryptoskillz.com/blog/media/posts/7/responsive/1_KOjqZHotBNn9-PIMA9XTHQ-sm.jpeg 480w ,https://cryptoskillz.com/blog/media/posts/7/responsive/1_KOjqZHotBNn9-PIMA9XTHQ-md.jpeg 768w ,https://cryptoskillz.com/blog/media/posts/7/responsive/1_KOjqZHotBNn9-PIMA9XTHQ-lg.jpeg 1024w ,https://cryptoskillz.com/blog/media/posts/7/responsive/1_KOjqZHotBNn9-PIMA9XTHQ-xl.jpeg 1360w ,https://cryptoskillz.com/blog/media/posts/7/responsive/1_KOjqZHotBNn9-PIMA9XTHQ-2xl.jpeg 1600w" data-sizes="auto" alt=""></figure><header class="u-header post__header"><h1>WWW and modularisation</h1><div class="u-header__meta u-small"><div><a href="https://cryptoskillz.com/blog/authors/cryptoskillz/" title="cryptoskillz">cryptoskillz</a> <time datetime="2018-09-29T11:36">September 29, 2018 </time><a href="https://cryptoskillz.com/blog/ecs/" class="u-tag u-tag--1">ecs</a></div></div></header><div class="post__entry u-inner"><p> </p><h1 id="40c8" class="ku kv bf av au el kw kx ky kz la lb lc ld le lf lg" data-selectable-paragraph="">Introduction</h1><p id="dfde" class="lh li bf av lj b lk ll lm ln lo lp lq lr ls lt lu" data-selectable-paragraph="">This guide aims to program a website to accept Bitcoin. In the previous part, we coded "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/server/sweep.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">sweep.js</a>"</strong> which allowed us to move payments to our cold storage.</p><p id="d59d" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">In this section, we are going to modularise the code (a little) and create a "<a href="http://s3-eu-west-1.amazonaws.com/srcrypto/demo/index.html" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer"><strong class="lj lz">WWW</strong></a>" page to allow us to sell something and accept "<strong class="lj lz"><a href="https://en.wikipedia.org/wiki/Bitcoin" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">Bitcoin</a>"</strong> as payment, yay.</p><p id="7977" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">The branch for this tutorial can be found "<strong><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/tree/www" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">here</a></strong>".</p><h1 id="bedb" class="ku kv bf av au el kw kx ky kz la lb lc ld le lf lg" data-selectable-paragraph="">The Modularisation</h1><p id="da7f" class="lh li bf av lj b lk ll lm ln lo lp lq lr ls lt lu" data-selectable-paragraph="">If you look at the code you will see it has been broken down into 3 sections.</p><h2 id="2a53" class="mf kv bf av au el mg mh mi mj mk ml mm mn mo mp mq" data-selectable-paragraph=""><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/tree/www/server" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer"><strong class="ch">Server</strong></a></h2><p id="c8de" class="lh li bf av lj b lk ll lm ln lo lp lq lr ls lt lu" data-selectable-paragraph="">Basically, all the "<strong class="lj lz"><a href="https://nodejs.org/en/" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">Node.js</a>"</strong> code we have written has been moved into the server directory. On top of this, there has been a number of changes have been made to make the code flow better.</p><p id="e5ba" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph=""><strong class="lj lz">“monitor.js”</strong> and “<strong class="lj lz">generate.js</strong>” have been combined into one file "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/server/index.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">index.js</a>"</strong>.</p><p id="e55f" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">Note the "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/server/monitor.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">monitor.js</a>"</strong> is still there but it has been changed to function as a back-end tool. Imagine the scenario where the user pays for something in the website ("<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/tree/www/www" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">WWW</a>"</strong>) they are not likely to leave the webpage open until the transaction confirms (though they may) so that is why we have the 2 ways of checking for a payment. Api/monitor (in "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/server/index.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">index.js</a>"</strong>) is meant for the website to check for the payment and "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/server/monitor.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">monitor.js</a>"</strong> has been designed to be used as a back office tool that will check for payment on a schedule and call the back office task as appropriate.</p><pre class="mr ms mt mu mv dv ge df"><span id="8944" class="mf kv bf av mw b dz mx my l mz" data-selectable-paragraph="">//pass it an address and it will check if payment has been made.  See this just like monitor js does but it is not on a timer.<br>app.get('/api/monitor', (req, res) =&gt; {<br>})</span><span id="d3bd" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//generate an address and output it<br>app.get('/api/address', (req, res) =&gt; {<br>})</span></pre><p id="1314" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph=""><span class="lj lz">"<a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/server/sweep.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer" style="font-weight: bold;">sweep.js</a>"</span> is unchanged at this point. In a later tutorial, we will add an admin and wrap this into to allow a back office administrator to sweep payments.</p><h2 id="d1d4" class="mf kv bf av au el mg mh mi mj mk ml mm mn mo mp mq" data-selectable-paragraph=""><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/tree/master/cdn" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">CDN</a></h2><p id="5c22" class="lh li bf av lj b lk ll lm ln lo lp lq lr ls lt lu" data-selectable-paragraph="">The "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/tree/master/cdn" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">CDN</a>"</strong> folder contains all of the javascript that is required to generate a cart and process a payment. This has been referenced directly by "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/www/" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">WWW</a>"</strong> via "<a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/www/index.html" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer"><strong class="lj lz">index.</strong></a><strong class="lj lz">html"</strong> however in the future we will recode this so it can be injected into any site with one line of code from a "<strong class="lj lz"><a href="https://en.wikipedia.org/wiki/Content_delivery_network" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">CDN</a>"</strong></p><p id="baf3" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">It has been coded in jQuery (as most people know this) but later it will be recoded as pure javascript so it deploys into websites with zero friction. You can grab this file ("<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/cdn/js/sr.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">sr.js</a>"</strong>) and put in your local assets directory and access it this ay if you prefer.</p><p id="e37d" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">I will not go into detail of what each of these functions is doing as it is quite a simple piece of Javascript and fully documented. However in the future when we do the upgrades proposed above then we will break it down in detail.</p><pre class="mr ms mt mu mv dv ge df"><span id="f3cd" class="mf kv bf av mw b dz mx my l mz" data-selectable-paragraph="">jQuery(document).ready(function($) {<br>  //set the server url.<br>  var serverurl = "<a href="http://127.0.0.1:3000/" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">http://127.0.0.1:3000/</a>";<br>  //set the address<br>  var address = "";<br>  //init price var<br>  var productPrice = 0;<br>  var cartWrapper = $(".cd-cart-container");<br>  //set the cart wrapper<br>  var productCustomization = $(".cd-customization"),<br>    //set the cart<br>    cart = $(".cd-cart"),<br>    //set animating boolean<br>    animating = false;</span><span id="2fcd" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//call the server to get a btc address<br>  $.get(serverurl + "api/address", function(data) {<br>    //get the data<br>    data = jQuery.parseJSON(data);<br>    //console.log(data.address);<br>    address = data.address;<br>    //set the address<br>    $("#bitcoinaddress").text(address);<br>    //set the href of the bitcoin address<br>    $("#bitcoinaddress").attr("href", "bitcoin:" + address);<br>    //generate the qr code<br>    $("#bitcoinqrcode").attr(<br>      "src",<br>      "<a href="https://chart.googleapis.com/chart?chs=250x250&amp;cht=qr&amp;chl=" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">https://chart.googleapis.com/chart?chs=250x250&amp;cht=qr&amp;chl=</a>" + address<br>    );<br>    //init the product<br>  });</span><span id="2ff8" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">initCustomization(productCustomization);</span><span id="d85b" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//check we have a cart<br>  if (cartWrapper.length &gt; 0) {<br>    //store jQuery objects for later use<br>    var cartBody = cartWrapper.find(".body");<br>    var cartList = cartBody.find("ul").eq(0);<br>    var cartTotal = cartWrapper.find(".checkout").find("span");<br>    //console.log(cartTotal);<br>    var cartTrigger = cartWrapper.children(".cd-cart-trigger");<br>    var cartCount = cartTrigger.children(".count");<br>    var addToCartBtn = $(".sr-add-to-cart");<br>    var bitcoinback = cartWrapper.find(".bitcoinback");</span><span id="2ba2" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//add product to cart<br>    addToCartBtn.on("click", function(event) {<br>      event.preventDefault();<br>      addToCart($(this));<br>    });</span><span id="3c1e" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//open/close cart<br>    cartTrigger.on("click", function(event) {<br>      event.preventDefault();<br>      toggleCart();<br>    });</span><span id="5fe2" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//close cart when clicking on the .cd-cart-container::before (bg layer)<br>    cartWrapper.on("click", function(event) {<br>      if ($(event.target).is($(this))) toggleCart(true);<br>    });</span><span id="5231" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//delete an item from the cart<br>    cartList.on("click", ".delete-item", function(event) {<br>      event.preventDefault();<br>      //remove the product<br>      removeProduct($(event.target).parents(".product"));<br>    });</span><span id="7162" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//load btc address for payment<br>    cartWrapper.on("click", ".checkout", function(event) {<br>      event.preventDefault();<br>      bitcoinback.addClass("visible");<br>      ///$('#bitcoin-address-template').show();<br>      $("#bitcoinaddresswrapper").show();<br>      //hide the cart items<br>      $("#cartlistitems").hide();<br>    });</span><span id="1bfd" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//copy the btc address to the clipboard<br>    cartWrapper.on("click", ".bitcoinaddresscopy", function(event) {<br>      event.preventDefault();<br>      /* Get the text field */<br>      var element = document.getElementById("bitcoinaddress");<br>      var $temp = $("&lt;input&gt;");<br>      $("body").append($temp);<br>      $temp.val($(element).text()).select();<br>      document.execCommand("copy");<br>      //$temp.remove();<br>    });</span><span id="3f43" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//back button is clicked so show items<br>    cartWrapper.on("click", "#checkoutbitocoin", function(event) {<br>      event.preventDefault();<br>      bitcoinback.removeClass("visible");<br>      $("#bitcoinaddresswrapper").hide();<br>      //$('#bitcoin-address-template').hide();<br>      $("#cartlistitems").show();<br>    });<br>  }</span><span id="acb0" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">function initCustomization(items) {<br>    items.each(function() {<br>      var actual = $(this),<br>        selectOptions = actual.find('[data-type="select"]'),<br>        addToCartBtn = actual.find(".sr-add-to-cart"),<br>        touchSettings = actual.next(".cd-customization-trigger");</span><span id="6af4" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//detect click on ul.size/ul.color list elements<br>      selectOptions.on("click", function(event) {<br>        var selected = $(this);<br>        //open/close options list<br>        selected.toggleClass("is-open");<br>        resetCustomization(selected);</span><span id="edc0" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">if ($(event.target).is("li")) {<br>          // update selected option<br>          var activeItem = $(event.target),<br>            index = activeItem.index() + 1;</span><span id="7285" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">activeItem<br>            .addClass("active")<br>            .siblings()<br>            .removeClass("active");<br>          selected<br>            .removeClass("selected-1 selected-2 selected-3")<br>            .addClass("selected-" + index);<br>          // if color has been changed, update the visible product image<br>          selected.hasClass("sr-color") &amp;&amp; updateSlider(selected, index - 1);<br>        }<br>      });</span><span id="cca0" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//detect click on the add-to-cart button<br>      addToCartBtn.on("click", function() {<br>        if (!animating) {<br>          //animate if not already animating<br>          animating = true;<br>          resetCustomization(addToCartBtn);</span><span id="7b73" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">addToCartBtn<br>            .addClass("is-added")<br>            .find("path")<br>            .eq(0)<br>            .animate(<br>              {<br>                //draw the check icon<br>                "stroke-dashoffset": 0<br>              },<br>              300,<br>              function() {<br>                setTimeout(function() {<br>                  //updateCart();<br>                  addToCartBtn<br>                    .removeClass("is-added")<br>                    .find("em")<br>                    .on(<br>                      "webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",<br>                      function() {<br>                        //wait for the end of the transition to reset the check icon<br>                        addToCartBtn<br>                          .find("path")<br>                          .eq(0)<br>                          .css("stroke-dashoffset", "19.79");<br>                        animating = false;<br>                      }<br>                    );</span><span id="c724" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">if ($(".no-csstransitions").length &gt; 0) {<br>                    // check if browser doesn't support css transitions<br>                    addToCartBtn<br>                      .find("path")<br>                      .eq(0)<br>                      .css("stroke-dashoffset", "19.79");<br>                    animating = false;<br>                  }<br>                }, 600);<br>              }<br>            );<br>        }<br>      });</span><span id="3e78" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//detect click on the settings icon - touch devices only<br>      touchSettings.on("click", function(event) {<br>        event.preventDefault();<br>        resetCustomization(addToCartBtn);<br>      });<br>    });<br>  }</span><span id="4a25" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">/*<br>  This function deals with showing or hiding the cart.<br> */<br>  function toggleCart(bool) {<br>    //always hide the address regardless of the toggle state as we never want to show this unless the<br>    //checkout button has been clicked<br>    $("#bitcoinaddresswrapper").hide();<br>    //check if the cart is open or not<br>    var cartIsOpen =<br>      typeof bool === "undefined" ? cartWrapper.hasClass("cart-open") : bool;</span><span id="360c" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">if (cartIsOpen) {<br>      cartWrapper.removeClass("cart-open");<br>      bitcoinback.removeClass("visible");<br>      cartList.find(".deleted").remove();<br>      bitcoinback.removeClass("visible");<br>      $("#bitcoin-address-template").hide();<br>      $("#cartlistitems").show();</span><span id="ef26" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">setTimeout(function() {<br>        cartBody.scrollTop(0);<br>        //check if cart empty to hide it<br>        if (<br>          Number(<br>            cartCount<br>              .find("li")<br>              .eq(0)<br>              .text()<br>          ) == 0<br>        )<br>          cartWrapper.addClass("empty");<br>      }, 500);<br>    } else {<br>      cartWrapper.addClass("cart-open");<br>    }<br>  }</span><span id="07b8" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">function addToCart(trigger) {<br>    var cartIsEmpty = cartWrapper.hasClass("empty");<br>    //update cart product list<br>    addProduct(trigger.data("price"), trigger.data("name"), trigger.data("id"));<br>    //update number of items<br>    updateCartCount(cartIsEmpty);<br>    //update total price<br>    updateCartTotal(trigger.data("price"), true);<br>    //show cart<br>    cartWrapper.removeClass("empty");<br>  }</span><span id="bbfd" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">function addProduct(price, name, productId) {<br>    //get the product quantity<br>    prodcutquantity = $("#productquantity").val();<br>    //check if its set or not if not then set it<br>    if (prodcutquantity == undefined) prodcutquantity = 0;<br>    //increment it by 1<br>    prodcutquantity++;<br>    //empty  the car contents<br>    cartList.empty();<br>    //build the row html<br>    //main product div<br>    var prodcuthtml = "";<br>    var prodcuthtml = prodcuthtml + '&lt;li class="product"&gt;';<br>    //product image<br>    var prodcuthtml =<br>      prodcuthtml +<br>      '&lt;div class="product-image"&gt;&lt;a href="#0"&gt;&lt;img src="img/product-preview.png" alt="placeholder"&gt;&lt;/a&gt;&lt;/div&gt;';<br>    //product details div<br>    var prodcuthtml = prodcuthtml + '&lt;div class="product-details"&gt;';<br>    //product name<br>    var prodcuthtml = prodcuthtml + '&lt;h3&gt;&lt;a href="#0"&gt;' + name + "&lt;/a&gt;&lt;/h3&gt;";<br>    //product price<br>    var prodcuthtml =<br>      prodcuthtml + '&lt;span class="productprice"&gt;$' + price + "&lt;/span&gt;";<br>    //delete option<br>    var prodcuthtml =<br>      prodcuthtml + '&lt;a href="#0" class="delete-item"&gt;Delete&lt;/a&gt;';<br>    //actions div<br>    var prodcuthtml = prodcuthtml + '&lt;div class="actions"&gt;';<br>    //quantity label<br>    var prodcuthtml =<br>      prodcuthtml + '&lt;label for="cd-product-' + productId + '"&gt;Qty&lt;/label&gt;';<br>    //quantity select<br>    var prodcuthtml =<br>      prodcuthtml +<br>      '&lt;span class="select"&gt;&lt;select id="productquantity" name="productquantity"&gt;';<br>    var i = 0;<br>    for (i = 1; i &lt; 11; i++) {<br>      if (i == prodcutquantity)<br>        var prodcuthtml =<br>          prodcuthtml + '&lt;option value="' + i + '" selected&gt;' + i + "&lt;/option&gt;";<br>      else<br>        var prodcuthtml =<br>          prodcuthtml + '&lt;option value="' + i + '"&gt;' + i + "&lt;/option&gt;";<br>    }<br>    //end of actions div<br>    var prodcuthtml = prodcuthtml + "&lt;/div&gt;";<br>    //end of products details div<br>    var prodcuthtml = prodcuthtml + "&lt;/div&gt;";<br>    //end of product div<br>    var prodcuthtml = prodcuthtml + "&lt;/div&gt;";<br>    //end of li<br>    var prodcuthtml = prodcuthtml + "&lt;/li&gt;";<br>    //add it<br>    //console.log(prodcuthtml);<br>    cartList.prepend(prodcuthtml);<br>    //updateCart()<br>  }</span><span id="5620" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//remove the product<br>  function removeProduct(product) {<br>    var topPosition =<br>        product.offset().top - cartBody.children("ul").offset().top,<br>      productTotPrice = productPrice;<br>    product.css("top", topPosition + "px").addClass("deleted");<br>    cartTotal.text(0);<br>    productQuantity = 0;<br>    updateCartCount(true, 0);<br>  }</span><span id="d142" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">//update the counter<br>  function updateCartCount(emptyCart, quantity) {<br>    //check if cart is empty<br>    if (emptyCart == true &amp;&amp; quantity == 0) {<br>      var actual = 0;<br>      var next = 1;<br>      cartCount<br>        .find("li")<br>        .eq(0)<br>        .text(actual);<br>      cartCount<br>        .find("li")<br>        .eq(1)<br>        .text(next);<br>    } else {<br>      //check if it is the first time the cart is launched<br>      if (typeof quantity === "undefined") {<br>        var actual =<br>          Number(<br>            cartCount<br>              .find("li")<br>              .eq(0)<br>              .text()<br>          ) + 1;<br>        var next = actual + 1;</span><span id="8db6" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">if (emptyCart) {<br>          cartCount<br>            .find("li")<br>            .eq(0)<br>            .text(actual);<br>          cartCount<br>            .find("li")<br>            .eq(1)<br>            .text(next);<br>        } else {<br>          cartCount.addClass("update-count");</span><span id="1b74" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">setTimeout(function() {<br>            cartCount<br>              .find("li")<br>              .eq(0)<br>              .text(actual);<br>          }, 150);</span><span id="ea88" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">setTimeout(function() {<br>            cartCount.removeClass("update-count");<br>          }, 200);</span><span id="96db" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">setTimeout(function() {<br>            cartCount<br>              .find("li")<br>              .eq(1)<br>              .text(next);<br>          }, 230);<br>        }<br>      } else {<br>        var actual =<br>          Number(<br>            cartCount<br>              .find("li")<br>              .eq(0)<br>              .text()<br>          ) + quantity;<br>        var next = actual + 1;</span><span id="553c" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">cartCount<br>          .find("li")<br>          .eq(0)<br>          .text(actual);<br>        cartCount<br>          .find("li")<br>          .eq(1)<br>          .text(next);<br>      }<br>    }<br>  }</span><span id="c8f0" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">function updateCartTotal(price, bool) {<br>    //console.log(cartTotal);<br>    bool<br>      ? cartTotal.text((Number(cartTotal.text()) + Number(price)).toFixed(2))<br>      : cartTotal.text((Number(cartTotal.text()) - Number(price)).toFixed(2));<br>    //cartTotal.text( (Number(cartTotal.text()) + Number(price)).toFixed(2);<br>    //cartTotal.text( (Number(cartTotal.text()) - Number(price)).toFixed(2) );<br>  }</span><span id="9ac0" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">function updateSlider(actual, index) {<br>    var slider = actual<br>        .parent(".cd-customization")<br>        .prev("a")<br>        .children(".cd-slider-wrapper"),<br>      slides = slider.children("li");<br>    slides<br>      .eq(index)<br>      .removeClass("move-left")<br>      .addClass("selected")<br>      .prevAll()<br>      .removeClass("selected")<br>      .addClass("move-left")<br>      .end()<br>      .nextAll()<br>      .removeClass("selected move-left");<br>  }</span><span id="01f8" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">function resetCustomization(selectOptions) {<br>    //close ul.clor/ul.size if they were left open and user is not interacting with them anymore<br>    //remove the .hover class from items if user is interacting with a different one<br>    selectOptions<br>      .siblings('[data-type="select"]')<br>      .removeClass("is-open")<br>      .end()<br>      .parents(".cd-single-item")<br>      .addClass("hover")<br>      .parent("li")<br>      .siblings("li")<br>      .find(".cd-single-item")<br>      .removeClass("hover")<br>      .end()<br>      .find('[data-type="select"]')<br>      .removeClass("is-open");<br>  }<br>});</span></pre><h2 id="8680" class="mf kv bf av au el mg mh mi mj mk ml mm mn mo mp mq" data-selectable-paragraph=""><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/tree/www/www" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">WWW</a></h2><p id="cbe6" class="lh li bf av lj b lk ll lm ln lo lp lq lr ls lt lu" data-selectable-paragraph="">The "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/tree/www/www" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">WWW</a>"</strong> directory contains an example website that renders one product and the includes the js file ("<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/cdn/js/sr.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">sr.js</a>"</strong>) to render the cart and accept payment. Let’s look at the key parts of it.</p><p id="78cf" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">You can see a demo of this running "<strong><a href="https://cryptoskillz.com/srcrypto" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">here</a></strong>".</p><p id="a57c" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">The code below creates a gallery of products. Though I am only listing one it has the ability to list many. This will be covered in a future refactor to "<strong class="lj lz"><a href="https://github.com/cryptoskillz/Bitcoin-Tutorial/blob/www/cdn/js/sr.js" class="cb bx lv lw lx ly" target="_blank" rel="noopener noreferrer">sr.js</a>"</strong></p><pre class="mr ms mt mu mv dv ge df"><span id="833b" class="mf kv bf av mw b dz mx my l mz" data-selectable-paragraph="">&lt;ul class="cd-gallery"&gt;<br>  &lt;li&gt;<br>   &lt;div class="cd-single-item"&gt;<br>    &lt;a href="#0"&gt;<br>     &lt;ul class="cd-slider-wrapper"&gt;<br>      &lt;li&gt;&lt;img src="img/thumb-1.jpg" alt="Preview image"&gt;&lt;/li&gt;<br>      &lt;li class="selected"&gt;&lt;img src="img/thumb-2.jpg" alt="Preview image"&gt;&lt;/li&gt;<br>      &lt;li&gt;&lt;img src="img/thumb-3.jpg" alt="Preview image"&gt;&lt;/li&gt;<br>     &lt;/ul&gt;<br>    &lt;/a&gt;</span><span id="bb2f" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;div class="cd-customization"&gt;<br>     &lt;div class="sr-color selected-2" data-type="select"&gt;<br>      &lt;ul&gt;<br>       &lt;li class="sr-color-1"&gt;color-1&lt;/li&gt;<br>       &lt;li class="sr-color-2 active"&gt;color-2&lt;/li&gt;<br>       &lt;li class="sr-color-3"&gt;color-3&lt;/li&gt;<br>      &lt;/ul&gt;<br>     &lt;/div&gt;<br>     <br>     &lt;div class="sr-size" data-type="select"&gt;<br>      &lt;ul&gt;<br>       &lt;li class="small active"&gt;Small&lt;/li&gt;<br>       &lt;li class="medium"&gt;Medium&lt;/li&gt;<br>       &lt;li class="large"&gt;Large&lt;/li&gt;<br>      &lt;/ul&gt;<br>     &lt;/div&gt;</span><span id="aab9" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;button class="sr-add-to-cart" data-price="9.99" data-name='T Shirt' data-id='1'&gt;<br>      &lt;em&gt;Add to Cart&lt;/em&gt;<br>      &lt;svg x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32"&gt;<br>       &lt;path stroke-dasharray="19.79 19.79" stroke-dashoffset="19.79" fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square" stroke-miterlimit="10" d="M9,17l3.9,3.9c0.1,0.1,0.2,0.1,0.3,0L23,11"/&gt;<br>      &lt;/svg&gt;<br>     &lt;/button&gt;<br>    &lt;/div&gt; &lt;!-- .cd-customization --&gt;</span><span id="bbb0" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;button class="cd-customization-trigger"&gt;Customize&lt;/button&gt;<br>   &lt;/div&gt; &lt;!-- .cd-single-item --&gt;</span><span id="472d" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;div class="cd-item-info"&gt;<br>    &lt;b&gt;&lt;a href="#0"&gt;T Shirt&lt;/a&gt;&lt;/b&gt;<br>    &lt;em&gt;$9.99&lt;/em&gt;<br>   &lt;/div&gt; &lt;!-- cd-item-info --&gt;<br>  &lt;/li&gt;<br> &lt;/ul&gt; &lt;!-- cd-gallery --&gt;</span></pre><p id="f4d3" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">The code below renders the cart.</p><pre class="mr ms mt mu mv dv ge df"><span id="efe7" class="mf kv bf av mw b dz mx my l mz" data-selectable-paragraph="">&lt;div class="cd-cart-container empty"&gt;<br> &lt;a href="#0" class="cd-cart-trigger"&gt;<br>  Cart<br>  &lt;ul class="count"&gt; &lt;!-- cart items count --&gt;<br>   &lt;li&gt;0&lt;/li&gt;<br>   &lt;li&gt;0&lt;/li&gt;<br>  &lt;/ul&gt; &lt;!-- .count --&gt;<br> &lt;/a&gt;</span><span id="cae4" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;div class="cd-cart"&gt;<br>  &lt;div class="wrapper"&gt;<br>   &lt;header&gt;<br>    &lt;h2&gt;Cart&lt;/h2&gt;<br>    &lt;span class="bitcoinback" &gt;&lt;a id="checkoutbitocoin" href="#0"&gt;Back&lt;/a&gt;&lt;/span&gt;</span><span id="af20" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;/header&gt;<br>   <br>   &lt;div class="body"&gt;<br>    &lt;ul id='cartlistitems'&gt;<br>     &lt;!-- products added to the cart will be inserted here using JavaScript --&gt;<br>    &lt;/ul&gt;</span><span id="9a23" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;div id="bitcoinaddresswrapper"&gt;<br>     &lt;div &gt;<br>            &lt;a id="bitcoinaddress" class="bitcoinaddress" href="bitcoin:2N3Xtg7pBjUG4RPaiwfc2t3wftvLGWv6i2K" &gt;19356KxTs9Bw5AAdxens5hoxDSp5bsUKse&lt;/a&gt;<br>        &lt;/div&gt;<br>        &lt;div class="bitcoinoptions" &gt;<br>         &lt;a href="#" class="bitcoinaddresscopy"&gt;<br>            &lt;i class="fa fa-copy"&gt;&lt;/i&gt;<br>            Copy<br>        &lt;/a&gt;<br>        <br>        &lt;a href="bitcoin:2N3Xtg7pBjUG4RPaiwfc2t3wftvLGWv6i2K" class=""&gt;<br>            &lt;i class="fa fa-btc"&gt;&lt;/i&gt;<br>            Pay from wallet<br>        &lt;/a&gt;<br>        &lt;/div&gt;</span><span id="7177" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;img id="bitcoinqrcode" src="" /&gt;<br>    &lt;/div&gt;</span><span id="5170" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;/div&gt;</span><span id="792f" class="mf kv bf av mw b dz na nb nc nd ne my l mz" data-selectable-paragraph="">&lt;footer&gt;<br>    &lt;a href="#0" class="checkout btn"&gt;&lt;em&gt;Checkout - $&lt;span&gt;0&lt;/span&gt;&lt;/em&gt;&lt;/a&gt;<br>   &lt;/footer&gt;<br>  &lt;/div&gt;<br> &lt;/div&gt; &lt;!-- .cd-cart --&gt;<br>&lt;/div&gt; &lt;!-- cd-cart-container --&gt;</span></pre><h1 id="c235" class="ku kv bf av au el kw kx ky kz la lb lc ld le lf lg" data-selectable-paragraph="">The SQL</h1><p id="fa99" class="lh li bf av lj b lk ll lm ln lo lp lq lr ls lt lu" data-selectable-paragraph="">No changes to the SQL this time.</p><pre class="mr ms mt mu mv dv ge df"><span id="56d4" class="mf kv bf av mw b dz mx my l mz" data-selectable-paragraph="">CREATE TABLE "keys" ( <br>`id` INTEGER PRIMARY KEY AUTOINCREMENT,<br> `privatekey` TEXT,<br> `publickey` TEXT,<br> `address` TEXT,<br> `processed` INTEGER DEFAULT 0,<br> `swept` INTEGER DEFAULT 0 <br>)</span></pre><h1 id="0cfa" class="ku kv bf av au el kw kx ky kz la lb lc ld le lf lg" data-selectable-paragraph="">Conclusion</h1><p id="8dde" class="lh li bf av lj b lk ll lm ln lo lp lq lr ls lt lu" data-selectable-paragraph="">That is it we now have a system that allows us to build a simple website and take and process payments in Bitcoin. The following parts of this tutorial are not required reading but will get very granular in a certain section of this project including.</p><p id="ece2" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">Adding a SAAS admin area<br>Removing all dependencies <br>Adding our own full node</p><p id="53c6" class="lh li bf av lj b lk ma lm mb lo mc lq md ls me lu" data-selectable-paragraph="">Anything else that crops up with the eventual aim of having a Bitcoin-based e-commerce system.</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on October 10, 2019</div><div class="post__share"></div></aside><footer class="post__footer"><div class="post__bio u-author box"><div><h4 class="u-author__name"><a href="https://cryptoskillz.com/blog/authors/cryptoskillz/" title="cryptoskillz">cryptoskillz</a></h4></div></div><nav class="post__nav box"><div class="post__nav__prev"><a href="https://cryptoskillz.com/blog/move-payment-to-cold-storage.html" class="post__nav__link" rel="prev"><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/6/responsive/1_YYI3zd3a5mRDlodesvewtw-xs.jpeg" data-srcset="https://cryptoskillz.com/blog/media/posts/6/responsive/1_YYI3zd3a5mRDlodesvewtw-xs.jpeg" data-expand="300" alt=""><div class="u-small">Previous Post<h5>Move payment to cold storage</h5></div></a></div><div class="post__nav__next"><a href="https://cryptoskillz.com/blog/create-an-admin-and-hosting.html" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>Create an Admin and hosting</h5></div><img class="lazyload" src="https://cryptoskillz.com/blog/media/posts/8/responsive/1_IRIyXKuOZEJK1K2cq2dB4w-xs.jpeg" data-srcset="https://cryptoskillz.com/blog/media/posts/8/responsive/1_IRIyXKuOZEJK1K2cq2dB4w-xs.jpeg" data-expand="300" alt=""></a></div></nav></footer></article><div class="banner banner--after-post"><script type="text/javascript" src="https://cryptoskillz.com/srcrypto/prod/cdn/js/sr.js"></script><script type="text/javascript">SR.init(["https://ecslive.cryptoskillz.com/",15,"https://cryptoskillz.com/srcrypto/prod/cdn/theme/","39",1,"GB",0,""]);</script></div></main><div class="sidebar"><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://cryptoskillz.com/blog/cyphernode/">cyphernode</a> <span class="u-small">(4)</span></li><li><a href="https://cryptoskillz.com/blog/ecs/">ecs</a> <span class="u-small">(25)</span></li><li><a href="https://cryptoskillz.com/blog/fullnode/">fullnode</a> <span class="u-small">(8)</span></li><li><a href="https://cryptoskillz.com/blog/trx/">trx</a> <span class="u-small">(2)</span></li><li><a href="https://cryptoskillz.com/blog/wink/">wink</a> <span class="u-small">(2)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://cryptoskillz.com/blog/">cryptoskillz</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright">Powered by Publii</div></footer></div><script defer="defer" src="https://cryptoskillz.com/blog/assets/js/jquery-3.2.1.slim.min.js?v=5f48fc77cac90c4778fa24ec9c57f37d"></script><script defer="defer" src="https://cryptoskillz.com/blog/assets/js/scripts.min.js?v=07b53ae91f8045eab042a695e4a26034"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-111636971-1"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111636971-1');</script></body></html>